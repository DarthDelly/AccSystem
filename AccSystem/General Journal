import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.JTableHeader;
import javax.swing.table.TableRowSorter;
import java.awt.*;
import java.awt.event.*;
import java.awt.geom.Ellipse2D;
import java.io.*;
import java.util.Vector;

public class NewTransaction {
    private final JFrame frame;
    private JPanel bgPanel;
    private JPanel adminPanel;
    private JPanel contentPanel;
    private CardLayout cardLayout;

    private final DefaultTableModel transactionsModel;
    private final DefaultTableModel journalModel;
    private final DefaultTableModel ledgerModel;
    private final DefaultTableModel accountsModel;
    private final DefaultTableModel assetsModel;
    private final DefaultTableModel liabilitiesModel;

    private TableRowSorter<DefaultTableModel> transactionsSorter;

    public NewTransaction() {

        transactionsModel = new DefaultTableModel(new String[]{"Date", "Description", "Debit Account", "Credit Account", "Amount"}, 0) {
            @Override public boolean isCellEditable(int row, int column) { return false; }
        };
        journalModel = new DefaultTableModel(new String[]{"Date", "Description", "Account", "Debit", "Credit"}, 0) {
            @Override public boolean isCellEditable(int row, int column) { return false; }
        };
        ledgerModel = new DefaultTableModel(new String[]{"Date", "Description", "Debit Account", "Credit Account", "Amount", "Balance"}, 0) {
            @Override public boolean isCellEditable(int row, int column) { return false; }
        };
        accountsModel = new DefaultTableModel(new String[]{"Account", "Type", "Balance"}, 0) {
            @Override public boolean isCellEditable(int row, int column) { return false; }
        };
        assetsModel = new DefaultTableModel(new String[]{"Asset", "Amount"}, 0) {
            @Override public boolean isCellEditable(int row, int column) { return false; }
        };
        liabilitiesModel = new DefaultTableModel(new String[]{"Liabilities & Equity", "Amount"}, 0) {
            @Override public boolean isCellEditable(int row, int column) { return false; }
        };

        frame = new JFrame("Accounting System ");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setSize(1100, 650);
        frame.setResizable(false);
        frame.setLocationRelativeTo(null);

        bgPanel = new JPanel() {
            @Override
            protected void paintComponent(Graphics g) {
                super.paintComponent(g);

                ImageIcon bg = new ImageIcon("c:\\Users\\ASUS\\Documents\\ImageFile\\pic2.png");
                if (bg.getIconWidth() > 0) {
                    g.drawImage(bg.getImage(), 0, 0, getWidth(), getHeight(), this);
                } else {
 
                    g.setColor(new Color(34, 45, 63));
                    g.fillRect(0, 0, getWidth(), getHeight());
                }
            }
        };
        bgPanel.setLayout(null);

 
        adminPanel = new JPanel(null) {
            @Override public boolean contains(int x, int y) { return true; }
        };
        adminPanel.setBackground(Color.WHITE);
        adminPanel.setBounds(750, 0, 350, 650);
        adminPanel.setVisible(false);
        adminPanel.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY, 1, true));
        adminPanel.setOpaque(true);

        CircularImagePanel adminImage = new CircularImagePanel("c:\\Users\\ASUS\\Documents\\ImageFile\\icon1.png", 100);
        adminImage.setBounds(125, 140, 100, 100);
        adminPanel.add(adminImage);

        JLabel adminLabel = new JLabel("Admin", SwingConstants.CENTER);
        adminLabel.setFont(new Font("Dialog", Font.BOLD, 16));
        adminLabel.setBounds(100, 250, 150, 30);
        adminPanel.add(adminLabel);

        JButton logoutBtn = new JButton("Log Out");
        logoutBtn.setBounds(100, 310, 150, 40);
        logoutBtn.setBackground(new Color(40, 40, 40));
        logoutBtn.setForeground(Color.WHITE);
        logoutBtn.setFont(new Font("Dialog", Font.BOLD, 13));
        logoutBtn.setFocusPainted(false);
        logoutBtn.setBorderPainted(false);
        logoutBtn.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        logoutBtn.setOpaque(true);
        logoutBtn.setContentAreaFilled(true);
        adminPanel.add(logoutBtn);

        logoutBtn.addActionListener(e -> {
            int confirm = JOptionPane.showConfirmDialog(frame, "Log out and close the app?", "Confirm logout", JOptionPane.YES_NO_OPTION);
            if (confirm == JOptionPane.YES_OPTION) {
                frame.dispose();

            }
        });
        bgPanel.add(adminPanel);

        ImageIcon adminIcon = new ImageIcon("c:\\Users\\ASUS\\Documents\\ImageFile\\pic3.png");
        Image scaledAdminIcon = adminIcon.getImage().getScaledInstance(30, 30, Image.SCALE_SMOOTH);
        JButton adminBtn = new JButton(new ImageIcon(scaledAdminIcon));
        adminBtn.setBounds(995, 18, 65, 35);
        adminBtn.setBackground(new Color(40, 40, 40));
        adminBtn.setFocusPainted(false);
        adminBtn.setBorder(BorderFactory.createLineBorder(new Color(60, 60, 60), 2, true));
        adminBtn.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        adminBtn.setContentAreaFilled(true);
        adminBtn.setOpaque(true);
        bgPanel.add(adminBtn);

        adminBtn.addActionListener(e -> {
            boolean showing = adminPanel.isVisible();
            adminPanel.setVisible(!showing);
            if (!showing) {
                bgPanel.setComponentZOrder(adminPanel, 0);
                bgPanel.setComponentZOrder(adminBtn, 1);
            } else {
                bgPanel.setComponentZOrder(adminBtn, 0);
            }
            bgPanel.revalidate();
            bgPanel.repaint();
        });

        cardLayout = new CardLayout();
        contentPanel = new JPanel(cardLayout);
        contentPanel.setBounds(15, 85, 840, 510);
        contentPanel.setBorder(BorderFactory.createLineBorder(Color.DARK_GRAY, 2, true));
        contentPanel.add(new NewTransactionCard(), "newTransaction");
        contentPanel.add(new TransactionsCard(), "transactions");
        contentPanel.add(new AccountsCard(), "accounts");
        contentPanel.add(new GeneralJournalCard(), "generalJournal");
        contentPanel.add(new GeneralLedgerCard(), "generalLedger");
        contentPanel.add(new BalanceSheetCard(), "balanceSheet");
        cardLayout.show(contentPanel, "newTransaction");
        bgPanel.add(contentPanel);

        JButton loadBtn = new JButton("Load CSV");
        loadBtn.setBounds(670, 20, 120, 30);
        styleTextButton(loadBtn);
        loadBtn.addActionListener(e -> loadTransactionsFromCSV());
        bgPanel.add(loadBtn);

        JButton saveBtn = new JButton("Save CSV");
        saveBtn.setBounds(780, 20, 120, 30);
        styleTextButton(saveBtn);
        saveBtn.addActionListener(e -> saveTransactionsToCSV());
        bgPanel.add(saveBtn);

        JButton aboutBtn = new JButton("About");
        aboutBtn.setBounds(880, 20, 120, 30);
        styleTextButton(aboutBtn);
        aboutBtn.addActionListener(e -> JOptionPane.showMessageDialog(frame, "Simple Accounting UI demo\nAuthor: You"));
        bgPanel.add(aboutBtn);

        JButton newTransBtn = new JButton("New Transactions");
        newTransBtn.setBounds(868, 150, 200, 35);
        styleTextButton(newTransBtn);
        newTransBtn.addActionListener(e -> cardLayout.show(contentPanel, "newTransaction"));
        bgPanel.add(newTransBtn);

        JButton transBtn = new JButton("Transactions");
        transBtn.setBounds(868, 215, 200, 35);
        styleTextButton(transBtn);
        transBtn.addActionListener(e -> cardLayout.show(contentPanel, "transactions"));
        bgPanel.add(transBtn);

        JButton accountsBtn = new JButton("Accounts");
        accountsBtn.setBounds(868, 280, 200, 35);
        styleTextButton(accountsBtn);
        accountsBtn.addActionListener(e -> cardLayout.show(contentPanel, "accounts"));
        bgPanel.add(accountsBtn);

        JButton journalBtn = new JButton("General Journal");
        journalBtn.setBounds(868, 345, 200, 35);
        styleTextButton(journalBtn);
        journalBtn.addActionListener(e -> cardLayout.show(contentPanel, "generalJournal"));
        bgPanel.add(journalBtn);

        JButton ledgerBtn = new JButton("General Ledger");
        ledgerBtn.setBounds(868, 410, 200, 35);
        styleTextButton(ledgerBtn);
        ledgerBtn.addActionListener(e -> cardLayout.show(contentPanel, "generalLedger"));
        bgPanel.add(ledgerBtn);

        JButton balanceBtn = new JButton("Balance Sheet");
        balanceBtn.setBounds(868, 475, 200, 35);
        styleTextButton(balanceBtn);
        balanceBtn.addActionListener(e -> cardLayout.show(contentPanel, "balanceSheet"));
        bgPanel.add(balanceBtn);

        frame.setContentPane(bgPanel);
        frame.setVisible(true);
    }

    private void styleTextButton(JButton button) {
        button.setContentAreaFilled(false);
        button.setBorderPainted(false);
        button.setFocusPainted(false);
        button.setOpaque(false);
        button.setForeground(Color.WHITE);
        button.setFont(new Font("Dialog", Font.BOLD, 16));
        button.setCursor(new Cursor(Cursor.HAND_CURSOR));
    }

    private void styleMainButton(JButton button) {
        button.setBackground(new Color(40, 40, 40));
        button.setForeground(Color.WHITE);
        button.setFont(new Font("Dialog", Font.BOLD, 15));
        button.setFocusPainted(false);
        button.setBorderPainted(false);
        button.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        button.setOpaque(true);
        button.setContentAreaFilled(true);
    }

    private void styleSmallButton(JButton button) {
        button.setBackground(new Color(40, 40, 40));
        button.setForeground(Color.WHITE);
        button.setFont(new Font("Dialog", Font.BOLD, 12));
        button.setFocusPainted(false);
        button.setBorderPainted(false);
        button.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        button.setOpaque(true);
        button.setContentAreaFilled(true);
    }


    private class NewTransactionCard extends JPanel {
        public NewTransactionCard() {
            setLayout(null);
            setBackground(Color.WHITE);

            JLabel formTitle = new JLabel("New Transactions", SwingConstants.CENTER);
            formTitle.setFont(new Font("Dialog", Font.BOLD, 28));
            formTitle.setBounds(0, 20, 840, 40);
            add(formTitle);

            String[] labels = {"Date (MM-DD-YYYY)", "Description", "Debit Account", "Credit Account", "Amount"};
            int y = 80;

            JTextField dateField = new JTextField();
            JTextField descriptionField = new JTextField();
            JComboBox<String> debitDropdown = new JComboBox<>(getDebitAccounts());
            JComboBox<String> creditDropdown = new JComboBox<>(getCreditAccounts());
            JTextField amountField = new JTextField();

            for (int i = 0; i < labels.length; i++) {
                JLabel lbl = new JLabel(labels[i]);
                lbl.setFont(new Font("Dialog", Font.PLAIN, 15));
                lbl.setBounds(60, y, 180, 25);
                add(lbl);

                if (labels[i].equals("Debit Account")) {
                    debitDropdown.setBounds(240, y, 400, 30);
                    debitDropdown.setFont(new Font("Dialog", Font.PLAIN, 14));
                    add(debitDropdown);
                } else if (labels[i].equals("Credit Account")) {
                    creditDropdown.setBounds(240, y, 400, 30);
                    creditDropdown.setFont(new Font("Dialog", Font.PLAIN, 14));
                    add(creditDropdown);
                } else {
                    JTextField field = (labels[i].equals("Date (MM-DD-YYYY)")) ? dateField :
                                      (labels[i].equals("Description")) ? descriptionField :
                                      amountField;
                    field.setBounds(240, y, 400, 30);
                    field.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY, 1, true));
                    add(field);
                }
                y += 55;
            }

            JButton addBtn = new JButton("Add Transaction");
            addBtn.setBounds(330, 380, 200, 40);
            styleMainButton(addBtn);
            add(addBtn);

            addBtn.addActionListener(e -> {
                String date = dateField.getText().trim();
                String desc = descriptionField.getText().trim();
                String debit = (String) debitDropdown.getSelectedItem();
                String credit = (String) creditDropdown.getSelectedItem();
                String amountText = amountField.getText().trim();

                if (date.isEmpty() || desc.isEmpty() || amountText.isEmpty()) {
                    JOptionPane.showMessageDialog(this, "Please fill date, description and amount.", "Validation", JOptionPane.WARNING_MESSAGE);
                    return;
                }

                double amount;
                try {
                    amount = Double.parseDouble(amountText);
                } catch (NumberFormatException ex) {
                    JOptionPane.showMessageDialog(this, "Amount must be a number.", "Validation", JOptionPane.WARNING_MESSAGE);
                    return;
                }

                transactionsModel.addRow(new Object[]{date, desc, debit, credit, String.format("%.2f", amount)});

                journalModel.addRow(new Object[]{date, desc, debit, String.format("%.2f", amount), ""});
                journalModel.addRow(new Object[]{date, desc, credit, "", String.format("%.2f", amount)});

                double lastBalance = 0.0;
                int rowCount = ledgerModel.getRowCount();
                if (rowCount > 0) {
                    Object b = ledgerModel.getValueAt(rowCount - 1, 5);
                    if (b != null) {
                        try { lastBalance = Double.parseDouble(b.toString()); } catch (Exception ignored) {}
                    }
                }
                double newBalance = lastBalance + amount;
                ledgerModel.addRow(new Object[]{date, desc, debit, credit, String.format("%.2f", amount), String.format("%.2f", newBalance)});

                addOrUpdateAccount(debit, "ASSET", amount);
                addOrUpdateAccount(credit, "LIABILITY/REVENUE", -amount);

                dateField.setText("");
                descriptionField.setText("");
                amountField.setText("");

                JOptionPane.showMessageDialog(this, "Transaction added.");
            });
        }
    }

    private class TransactionsCard extends JPanel {
        public TransactionsCard() {
            setLayout(null);
            setBackground(Color.WHITE);

            JLabel title = new JLabel("Transactions", SwingConstants.CENTER);
            title.setFont(new Font("Dialog", Font.BOLD, 28));
            title.setBounds(0, 20, 840, 40);
            add(title);

            JLabel searchLabel = new JLabel("Search");
            searchLabel.setFont(new Font("Dialog", Font.PLAIN, 15));
            searchLabel.setBounds(130, 80, 50, 25);
            add(searchLabel);

            JTextField searchField = new JTextField();
            searchField.setBounds(190, 80, 380, 30);
            searchField.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY, 1, true));
            add(searchField);

            JButton clearBtn = new JButton("X Clear");
            clearBtn.setBounds(590, 80, 100, 30);
            styleMainButton(clearBtn);
            add(clearBtn);

            JTable transactionTable = new JTable(transactionsModel);
            transactionTable.setFont(new Font("Dialog", Font.PLAIN, 14));
            transactionTable.setRowHeight(25);
            transactionTable.setFillsViewportHeight(true);
            transactionTable.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);

            JTableHeader header = transactionTable.getTableHeader();
            header.setReorderingAllowed(false);
            header.setResizingAllowed(false);
            header.setFont(new Font("Dialog", Font.BOLD, 14));
            header.setBackground(new Color(0, 64, 64));
            header.setForeground(Color.WHITE);

            transactionTable.getColumnModel().getColumn(0).setPreferredWidth(100);
            transactionTable.getColumnModel().getColumn(1).setPreferredWidth(175);
            transactionTable.getColumnModel().getColumn(2).setPreferredWidth(175);
            transactionTable.getColumnModel().getColumn(3).setPreferredWidth(150);
            transactionTable.getColumnModel().getColumn(4).setPreferredWidth(100);

            JScrollPane scrollPane = new JScrollPane(transactionTable);
            scrollPane.setBounds(40, 130, 745, 330);
            add(scrollPane);

            transactionsSorter = new TableRowSorter<>(transactionsModel);
            transactionTable.setRowSorter(transactionsSorter);

            searchField.getDocument().addDocumentListener(new javax.swing.event.DocumentListener() {
                private void update() {
                    String text = searchField.getText();
                    if (text.trim().length() == 0) {
                        transactionsSorter.setRowFilter(null);
                    } else {
                        transactionsSorter.setRowFilter(RowFilter.regexFilter("(?i)" + text));
                    }
                }
                public void insertUpdate(javax.swing.event.DocumentEvent e) { update(); }
                public void removeUpdate(javax.swing.event.DocumentEvent e) { update(); }
                public void changedUpdate(javax.swing.event.DocumentEvent e) { update(); }
            });

            clearBtn.addActionListener(e -> searchField.setText(""));
        }
    }

    private class AccountsCard extends JPanel {
        public AccountsCard() {
            setLayout(null);
            setBackground(Color.WHITE);
            JLabel title = new JLabel("Accounts", SwingConstants.CENTER);
            title.setFont(new Font("Dialog", Font.BOLD, 28));
            title.setBounds(0, 20, 840, 40);
            add(title);

            JTable table = new JTable(accountsModel);
            table.setFont(new Font("Dialog", Font.PLAIN, 14));
            table.setRowHeight(25);
            table.setFillsViewportHeight(true);
            table.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);

            JTableHeader header = table.getTableHeader();
            header.setReorderingAllowed(false);
            header.setResizingAllowed(false);
            header.setFont(new Font("Dialog", Font.BOLD, 14));
            header.setBackground(new Color(0, 64, 64));
            header.setForeground(Color.WHITE);

            table.getColumnModel().getColumn(0).setPreferredWidth(250);
            table.getColumnModel().getColumn(1).setPreferredWidth(250);
            table.getColumnModel().getColumn(2).setPreferredWidth(250);

            JScrollPane scrollPane = new JScrollPane(table);
            scrollPane.setBounds(40, 80, 745, 380);
            add(scrollPane);
        }
    }

    private class GeneralJournalCard extends JPanel {
        public GeneralJournalCard() {
            setLayout(null);
            setBackground(Color.WHITE);
            JLabel title = new JLabel("General Journal", SwingConstants.CENTER);
            title.setFont(new Font("Dialog", Font.BOLD, 28));
            title.setBounds(0, 20, 840, 40);
            add(title);

            JTable table = new JTable(journalModel);
            table.setFont(new Font("Dialog", Font.PLAIN, 14));
            table.setRowHeight(25);
            table.setFillsViewportHeight(true);
            table.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);

            JTableHeader header = table.getTableHeader();
            header.setReorderingAllowed(false);
            header.setResizingAllowed(false);
            header.setFont(new Font("Dialog", Font.BOLD, 14));
            header.setBackground(new Color(0, 64, 64));
            header.setForeground(Color.WHITE);

            table.getColumnModel().getColumn(0).setPreferredWidth(100);
            table.getColumnModel().getColumn(1).setPreferredWidth(175);
            table.getColumnModel().getColumn(2).setPreferredWidth(175);
            table.getColumnModel().getColumn(3).setPreferredWidth(150);
            table.getColumnModel().getColumn(4).setPreferredWidth(150);

            JScrollPane scrollPane = new JScrollPane(table);
            scrollPane.setBounds(40, 80, 745, 380);
            add(scrollPane);
        }
    }

    private class GeneralLedgerCard extends JPanel {
        public GeneralLedgerCard() {
            setLayout(null);
            setBackground(Color.WHITE);
            JLabel title = new JLabel("General Ledger", SwingConstants.CENTER);
            title.setFont(new Font("Dialog", Font.BOLD, 28));
            title.setBounds(0, 20, 840, 40);
            add(title);

            JLabel searchLabel = new JLabel("Select Account");
            searchLabel.setFont(new Font("Dialog", Font.PLAIN, 15));
            searchLabel.setBounds(120, 80, 110, 25);
            add(searchLabel);

            JComboBox<String> allDropdown = new JComboBox<>(getAllAccounts());
            allDropdown.setBounds(250, 80, 400, 30);
            allDropdown.setFont(new Font("Dialog", Font.PLAIN, 14));
            add(allDropdown);

            JTable table = new JTable(ledgerModel);
            table.setFont(new Font("Dialog", Font.PLAIN, 14));
            table.setRowHeight(25);
            table.setFillsViewportHeight(true);
            table.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);

            JTableHeader header = table.getTableHeader();
            header.setReorderingAllowed(false);
            header.setResizingAllowed(false);
            header.setFont(new Font("Dialog", Font.BOLD, 14));
            header.setBackground(new Color(0, 64, 64));
            header.setForeground(Color.WHITE);

            table.getColumnModel().getColumn(0).setPreferredWidth(100);
            table.getColumnModel().getColumn(1).setPreferredWidth(130);
            table.getColumnModel().getColumn(2).setPreferredWidth(130);
            table.getColumnModel().getColumn(3).setPreferredWidth(130);
            table.getColumnModel().getColumn(4).setPreferredWidth(130);
            table.getColumnModel().getColumn(5).setPreferredWidth(130);

            JScrollPane scrollPane = new JScrollPane(table);
            scrollPane.setBounds(40, 130, 745, 330);
            add(scrollPane);
        }
    }

    private class BalanceSheetCard extends JPanel {
        public BalanceSheetCard() {
            setLayout(null);
            setBackground(Color.WHITE);
            JLabel title = new JLabel("Balance Sheet", SwingConstants.CENTER);
            title.setFont(new Font("Dialog", Font.BOLD, 28));
            title.setBounds(0, 20, 840, 40);
            add(title);

            JLabel side = new JLabel("Assets");
            side.setFont(new Font("Dialog", Font.BOLD, 21));
            side.setBounds(180, 70, 400, 40);
            add(side);

            JLabel side1 = new JLabel("Liabilities and Equity");
            side1.setFont(new Font("Dialog", Font.BOLD, 21));
            side1.setBounds(500, 70, 400, 40);
            add(side1);

            JTable assetTable = new JTable(assetsModel);
            assetTable.setFont(new Font("Dialog", Font.PLAIN, 14));
            assetTable.setRowHeight(25);
            assetTable.setFillsViewportHeight(true);
            assetTable.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);

            JTableHeader header1 = assetTable.getTableHeader();
            header1.setReorderingAllowed(false);
            header1.setResizingAllowed(false);
            header1.setFont(new Font("Dialog", Font.BOLD, 14));
            header1.setBackground(new Color(0, 64, 64));
            header1.setForeground(Color.WHITE);

            assetTable.getColumnModel().getColumn(0).setPreferredWidth(150);
            assetTable.getColumnModel().getColumn(1).setPreferredWidth(130);

            JScrollPane scrollPane1 = new JScrollPane(assetTable);
            scrollPane1.setBounds(40, 105, 350, 330);
            add(scrollPane1);

            JTable liabilityTable = new JTable(liabilitiesModel);
            liabilityTable.setFont(new Font("Dialog", Font.PLAIN, 14));
            liabilityTable.setRowHeight(25);
            liabilityTable.setFillsViewportHeight(true);
            liabilityTable.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);

            JTableHeader header2 = liabilityTable.getTableHeader();
            header2.setReorderingAllowed(false);
            header2.setResizingAllowed(false);
            header2.setFont(new Font("Dialog", Font.BOLD, 14));
            header2.setBackground(new Color(0, 64, 64));
            header2.setForeground(Color.WHITE);

            liabilityTable.getColumnModel().getColumn(0).setPreferredWidth(180);
            liabilityTable.getColumnModel().getColumn(1).setPreferredWidth(180);

            JScrollPane scrollPane2 = new JScrollPane(liabilityTable);
            scrollPane2.setBounds(420, 105, 370, 330);
            add(scrollPane2);

            JButton printBtn = new JButton("Print");
            printBtn.setBounds(350, 450, 100, 30);
            styleMainButton(printBtn);
            add(printBtn);

            printBtn.addActionListener(e -> JOptionPane.showMessageDialog(this, "Printing not implemented in demo."));
        }
    }



    private void addOrUpdateAccount(String accountName, String type, double change) {

        for (int i = 0; i < accountsModel.getRowCount(); i++) {
            String acct = (String) accountsModel.getValueAt(i, 0);
            if (acct.equals(accountName)) {

                Object balObj = accountsModel.getValueAt(i, 2);
                double bal = 0;
                try { bal = Double.parseDouble(balObj.toString()); } catch (Exception ignored) {}
                bal += change;
                accountsModel.setValueAt(String.format("%.2f", bal), i, 2);
                return;
            }
        }

        accountsModel.addRow(new Object[]{accountName, type, String.format("%.2f", change)});

        if (type.toUpperCase().contains("ASSET")) {
            assetsModel.addRow(new Object[]{accountName, String.format("%.2f", Math.max(0, change))});
        } else {
            liabilitiesModel.addRow(new Object[]{accountName, String.format("%.2f", Math.abs(change))});
        }
    }

    private void saveTransactionsToCSV() {
        JFileChooser chooser = new JFileChooser();
        chooser.setDialogTitle("Save Transactions CSV");
        int userSelection = chooser.showSaveDialog(frame);
        if (userSelection != JFileChooser.APPROVE_OPTION) return;
        File fileToSave = chooser.getSelectedFile();
        try (PrintWriter pw = new PrintWriter(new OutputStreamWriter(new FileOutputStream(fileToSave), "UTF-8"))) {
            
            for (int c = 0; c < transactionsModel.getColumnCount(); c++) {
                pw.print(transactionsModel.getColumnName(c));
                if (c < transactionsModel.getColumnCount() - 1) pw.print(",");
            }
            pw.println();

            for (int r = 0; r < transactionsModel.getRowCount(); r++) {
                for (int c = 0; c < transactionsModel.getColumnCount(); c++) {
                    Object val = transactionsModel.getValueAt(r, c);
                    pw.print(val == null ? "" : val.toString().replace(",", " "));
                    if (c < transactionsModel.getColumnCount() - 1) pw.print(",");
                }
                pw.println();
            }
            JOptionPane.showMessageDialog(frame, "Saved successfully.");
        } catch (IOException ex) {
            JOptionPane.showMessageDialog(frame, "Error saving file: " + ex.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

    private void loadTransactionsFromCSV() {
        JFileChooser chooser = new JFileChooser();
        chooser.setDialogTitle("Open Transactions CSV");
        int userSelection = chooser.showOpenDialog(frame);
        if (userSelection != JFileChooser.APPROVE_OPTION) return;
        File file = chooser.getSelectedFile();
        try (BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(file), "UTF-8"))) {
            String header = br.readLine(); 
            transactionsModel.setRowCount(0);
            String line;
            while ((line = br.readLine()) != null) {
                String[] parts = line.split(",", -1);
                
                if (parts.length >= 5) {
                    transactionsModel.addRow(new Object[]{parts[0], parts[1], parts[2], parts[3], parts[4]});
                }
            }
            JOptionPane.showMessageDialog(frame, "Loaded successfully.");
        } catch (IOException ex) {
            JOptionPane.showMessageDialog(frame, "Error loading file: " + ex.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

    private String[] getDebitAccounts() {
        return new String[]{
                "Cash – (ASSETS)",
                "Accounts Receivable – (ASSETS)",
                "Supplies – (ASSETS)",
                "Equipment – (ASSETS)",
                "Inventory – (ASSETS)",
                "Land – (ASSETS)",
                "Building – (ASSETS)",
                "Prepaid Expenses – (ASSETS)",
                "Rent Expense – (EXPENSES)",
                "Salaries Expense – (EXPENSES)",
                "Utilities Expense – (EXPENSES)",
                "Advertising Expense – (EXPENSES)",
                "Supplies Expense – (EXPENSES)",
                "Depreciation Expense – (EXPENSES)",
                "Owner's Drawings – (OWNER'S EQUITY)"
        };
    }

    private String[] getCreditAccounts() {
        return new String[]{
                "Accounts Payable – (LIABILITIES)",
                "Notes Payable – (LIABILITIES)",
                "Salaries Payable – (LIABILITIES)",
                "Taxes Payable – (LIABILITIES)",
                "Unearned Revenue – (LIABILITIES)",
                "Owner's Capital – (OWNER'S EQUITY)",
                "Service Revenue – (REVENUE)",
                "Sales Revenue – (REVENUE)",
                "Interest Income – (REVENUE)",
                "Fees Earned – (REVENUE)"
        };
    }

    private String[] getAllAccounts() {
        String[] all = getDebitAccounts();
        String[] credit = getCreditAccounts();
        String[] both = new String[all.length + credit.length];
        System.arraycopy(all, 0, both, 0, all.length);
        System.arraycopy(credit, 0, both, all.length, credit.length);
        return both;
    }

    class CircularImagePanel extends JPanel {
        private final Image image;

        public CircularImagePanel(String imagePath, int diameter) {
            ImageIcon icon = new ImageIcon(imagePath);
            Image img = icon.getImage();
            if (img != null) {
                this.image = img.getScaledInstance(diameter, diameter, Image.SCALE_SMOOTH);
            } else {
                
                this.image = null;
            }
            setPreferredSize(new Dimension(diameter, diameter));
            setOpaque(false);
        }

        @Override
        protected void paintComponent(Graphics g) {
            super.paintComponent(g);
            Graphics2D g2 = (Graphics2D) g.create();
            g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
            Shape circle = new Ellipse2D.Double(0, 0, getWidth(), getHeight());
            g2.setClip(circle);
            if (image != null) {
                g2.drawImage(image, 0, 0, getWidth(), getHeight(), this);
            } else {
                g2.setColor(new Color(200, 200, 200));
                g2.fill(circle);
            }
            g2.setClip(null);
            g2.setStroke(new BasicStroke(2f));
            g2.setColor(Color.LIGHT_GRAY);
            g2.draw(circle);
            g2.dispose();
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(NewTransaction::new);
    }
}
